<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Things I learned about zip files | </title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="In an effort to advance my python skills, I spent some time slowly pecking away at the puzzles on pythonchallenge. I got stuck on most of the challenges, and either had to search for a hint, or ask for help from a friend, or both. This latest one was particularly instructive, and it had to do with zipfiles.
I thought I knew what zip files were. I have used them since grad school, for transferring folders via email, and for compression. I used various utilities and command-line tools to deal with zipping and unzipping. But I never needed to know how they worked.">
    <meta name="generator" content="Hugo 0.148.1">
    
    
    
      <meta name="robots" content="index, follow">
    
    <meta name="author" content="Samantha G. Zeitlin">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css" >




    


    
      

    

    

    
      <link rel="canonical" href="https://szeitlin.github.io/posts/engineering/things-i-learned-about-zip-files-last-week/">
    

    <meta property="og:url" content="https://szeitlin.github.io/posts/engineering/things-i-learned-about-zip-files-last-week/">
  <meta property="og:title" content="Things I learned about zip files">
  <meta property="og:description" content="In an effort to advance my python skills, I spent some time slowly pecking away at the puzzles on pythonchallenge. I got stuck on most of the challenges, and either had to search for a hint, or ask for help from a friend, or both. This latest one was particularly instructive, and it had to do with zipfiles.
I thought I knew what zip files were. I have used them since grad school, for transferring folders via email, and for compression. I used various utilities and command-line tools to deal with zipping and unzipping. But I never needed to know how they worked.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2015-01-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2015-01-15T00:00:00+00:00">
    <meta property="article:tag" content="Unix">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Zip">

  <meta itemprop="name" content="Things I learned about zip files">
  <meta itemprop="description" content="In an effort to advance my python skills, I spent some time slowly pecking away at the puzzles on pythonchallenge. I got stuck on most of the challenges, and either had to search for a hint, or ask for help from a friend, or both. This latest one was particularly instructive, and it had to do with zipfiles.
I thought I knew what zip files were. I have used them since grad school, for transferring folders via email, and for compression. I used various utilities and command-line tools to deal with zipping and unzipping. But I never needed to know how they worked.">
  <meta itemprop="datePublished" content="2015-01-15T00:00:00+00:00">
  <meta itemprop="dateModified" content="2015-01-15T00:00:00+00:00">
  <meta itemprop="wordCount" content="719">
  <meta itemprop="keywords" content="Unix,Python,Zip">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Things I learned about zip files">
  <meta name="twitter:description" content="In an effort to advance my python skills, I spent some time slowly pecking away at the puzzles on pythonchallenge. I got stuck on most of the challenges, and either had to search for a hint, or ask for help from a friend, or both. This latest one was particularly instructive, and it had to do with zipfiles.
I thought I knew what zip files were. I have used them since grad school, for transferring folders via email, and for compression. I used various utilities and command-line tools to deal with zipping and unzipping. But I never needed to know how they worked.">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Things I learned about zip files</h1>
      
      <p class="tracked"><strong>Samantha G. Zeitlin</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2015-01-15T00:00:00Z">January 15, 2015</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>In an effort to advance my python skills, I spent some time slowly pecking away at <a href="http://pythonchallenge.com">the puzzles on pythonchallenge</a>. I got stuck on most of the challenges, and either had to search for a hint, or ask for help from a friend, or both. This latest one was particularly instructive, and it had to do with zipfiles.</p>
<p>I thought I knew what zip files were. I have used them since grad school, for transferring folders via email, and for compression. I used various utilities and command-line tools to deal with zipping and unzipping. But I never needed to know how they worked.</p>
<p>Then I got stuck for a while because I was looking specifically for a pythonic solution for zip files.</p>
<hr>
<p><strong>Things I Learned and How I Learned Them</strong></p>
<hr>
<p><strong>1. Pydoc != online documentation for some libraries</strong></p>
<p>For some python modules, the docstrings are great, and save you the work of having to hunt for the right version of the online documentation. Sometimes the docstrings are actually even better than the docs.</p>
<p>If you do this:</p>
<pre><code>pydoc zipfile.is_zipfile
</code></pre>
<p>You&rsquo;ll get this:</p>
<pre><code>zipfile.is_zipfile= is_zipfile(filename)
Quickly see if a file is a ZIP file by checking the magic number.

The filename argument may be a file or file-like object too
</code></pre>
<hr>
<p>I had gotten out of the habit of checking docstrings, because sometimes the docstrings are nonexistent, and then your best bet is to:</p>
<ol>
<li>Ask google</li>
<li>Find the source code, and hope it&rsquo;s really easy to
understand</li>
<li>Ask friends if they know, or if they can recommend something more usable</li>
</ol>
<hr>
<p><strong>2. Sometimes wikipedia fills in all the stuff the documentation skipped over.</strong></p>
<p>Some things <a href="https://en.wikipedia.org/wiki/Zip_(file_format)#Structure">I needed to know</a> were actually easier to find out about on wikipedia.</p>
<p>I did not know that there is such a thing as a <a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">magic number</a>, and that the one for ZIP actually spells out PK, for Phil Katz, the author of PKZIP.</p>
<hr>
<p><strong>3. It’s not actually cheating to use unix tricks.</strong></p>
<p>The command “file” will give you information about the filetype. So if you download something and you’re not sure what it is, or you just want to verify that it&rsquo;s what you thought it should be (say, before you decompress it), try this first.</p>
<pre><code>file myfile.zip
</code></pre>
<p>returns something like this:</p>
<pre><code>myfile.zip: Zip archive data, at least v2.0 to extract
</code></pre>
<hr>
<p>A friend recommended this nice tool called <a href="http://linux.die.net/man/1/xxd">xxd</a>, which gives you a hex dump of a file (even on Mac OSX!).</p>
<p>This can be useful if you suspect there is text hidden in a file that is otherwise only binary or not human-readable.</p>
<hr>
<p><strong>4. Some older modules haven’t been updated in a long time.</strong></p>
<p>The zip file format was invented ~20 years ago (1993), which means it doesn’t contain a way to work with these chunks of data in memory. So you have to save the whole thing to a file in order to do anything.</p>
<p>It turns out that <em>file-like objects</em> can be a pretty vague way to describe what kind of input a method can handle. And the error messages don&rsquo;t say what I really needed to hear, which was something like:</p>
<p><em>Please stop trying to give me a urllib2 response, I only eat files!</em></p>
<hr>
<p>Also, unlike more modern Python modules, there were not any examples of how to use the methods. So eventually I figured out that all I had to do was this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">import</span> urllib2
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#do what you normally do with a webpage</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;http://target_URL.zip&#34;</span>)
</span></span><span style="display:flex;"><span>    body <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#write it to a file, or you&#39;ll be screwed </span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;target.zip&#34;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> myfile:
</span></span><span style="display:flex;"><span>        myfile<span style="color:#f92672">.</span>write(body)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#confirm that it&#39;s actually a zip file</span>
</span></span><span style="display:flex;"><span>    print zipfile<span style="color:#f92672">.</span>is_zipfile(<span style="color:#e6db74">&#34;channel.zip&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#create a zip file object instance, so you can use the zipfile class methods</span>
</span></span><span style="display:flex;"><span>    myfile <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(<span style="color:#e6db74">&#34;channel.zip&#34;</span>)
</span></span></code></pre></div><hr>
<p><strong>5. Code Review.</strong></p>
<p>After reading the original version of this post, one friend commented that I should I should do it <a href="https://gist.github.com/ods94065/e8bb54570d170e97b19b">his way</a>, with StringIO.</p>
<p>Another friend emailed me this code block, which actually answered my original question about how to do it in-memory. As usual, the real lesson here is, if you don&rsquo;t know the name of something, it&rsquo;s hard to know how to look it up.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  <span style="color:#f92672">import</span> io
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> urllib2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    zip_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://somefile.zip&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen(zip_url)
</span></span><span style="display:flex;"><span>    body <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    byte_buffer <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>BytesIO(body)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    myfile <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(byte_buffer)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print myfile
</span></span><span style="display:flex;"><span>    print zipfile<span style="color:#f92672">.</span>is_zipfile(byte_buffer)
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/unix/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Unix</a>
   </li>
  
   <li class="list di">
     <a href="/tags/python/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Python</a>
   </li>
  
   <li class="list di">
     <a href="/tags/zip/" class="link f5 grow br-pill ba ph3 pv2 mb2 dib black sans-serif no-underline">Zip</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/engineering/recursion-excursion/">Recursion excursion</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://szeitlin.github.io/" >
    &copy; 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
